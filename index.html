
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H√†nh tr√¨nh 200K c·ªßa Nam - Game Qu·∫£n L√Ω T√†i Ch√≠nh</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- React, ReactDOM & Babel for JSX -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body {
            font-family: 'Quicksand', sans-serif;
            background-color: #e0f2fe;
            background-image: 
                radial-gradient(#bae6fd 1px, transparent 1px),
                radial-gradient(#bae6fd 1px, transparent 1px);
            background-size: 40px 40px;
            background-position: 0 0, 20px 20px;
            overflow-x: hidden;
        }
        .aspect-16-9-container {
            aspect-ratio: 16 / 9;
            min-height: 600px;
        }
        @media (max-width: 1024px) {
            .aspect-16-9-container {
                aspect-ratio: auto;
            }
        }
        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        @keyframes floating {
            0% { transform: translate(0, 0px); }
            50% { transform: translate(0, -15px); }
            100% { transform: translate(0, 0px); }
        }
        .liquid-fill {
            transition: height 1s cubic-bezier(0.4, 0, 0.2, 1);
        }
        input[type='range']::-webkit-slider-thumb {
            appearance: none;
            width: 28px;
            height: 28px;
            background: white;
            border: 6px solid currentColor;
            border-radius: 50%;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
            cursor: pointer;
        }
        .scrollbar-none::-webkit-scrollbar { display: none; }
    </style>
<script type="importmap">
{
  "imports": {
    "react/": "https://esm.sh/react@^19.2.4/",
    "react": "https://esm.sh/react@^19.2.4",
    "react-dom/": "https://esm.sh/react-dom@^19.2.4/"
  }
}
</script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        // --- CONSTANTS ---
        const INITIAL_TOTAL = 200000;
        const TOTAL_DAYS = 7;
        const DAYS_OF_WEEK = ['Th·ª© Hai', 'Th·ª© Ba', 'Th·ª© T∆∞', 'Th·ª© NƒÉm', 'Th·ª© S√°u', 'Th·ª© B·∫£y', 'Ch·ªß Nh·∫≠t'];

        const SCENARIOS = [
            {
                day: 1, question: "Ng√†y ƒë·∫ßu tu·∫ßn nƒÉng l∆∞·ª£ng, b·∫°n ƒë·ªãnh ƒÉn s√°ng th·∫ø n√†o?",
                option1: { label: "B√°nh m√¨ d√¢n t·ªï 15k", description: "V·ª´a r·∫ª v·ª´a no b·ª•ng", cost: 15000, category: 'essential' },
                option2: { label: "B√°t ph·ªü t√°i lƒÉn 45k", description: "T·ª± th∆∞·ªüng ƒë·∫ßu tu·∫ßn x·ªãn x√≤", cost: 45000, category: 'hobbies' }
            },
            {
                day: 2, question: "Ti·∫øt th·ªÉ d·ª•c n√≥ng n·ª±c, b·∫°n mu·ªën gi·∫£i kh√°t b·∫±ng g√¨?",
                option1: { label: "N∆∞·ªõc l·ªçc mang theo", description: "Ti·∫øt ki·ªám 100%", cost: 0, category: 'essential' },
                option2: { label: "Ly tr√† s·ªØa tr√¢n ch√¢u 35k", description: "S·∫£ng kho√°i t·ª©c th√¨", cost: 35000, category: 'hobbies' }
            },
            {
                day: 3, question: "B·∫°n ph√°t hi·ªán ra b·ªô ƒë·ªì d√πng h·ªçc t·∫≠p m·ªõi r·∫•t ƒë·∫πp!",
                option1: { label: "Ch·ªâ mua b√∫t bi 5k", description: "Mua th·ª© th·ª±c s·ª± c·∫ßn", cost: 5000, category: 'essential' },
                option2: { label: "Mua c·∫£ set 40k", description: "Ghi ch√©p th√™m c·∫£m h·ª©ng", cost: 40000, category: 'hobbies' }
            },
            {
                day: 4, question: "Chi·ªÅu nay tan h·ªçc s·ªõm, b·∫°n ƒë·ªãnh ƒëi ƒë√¢u?",
                option1: { label: "V·ªÅ nh√† ƒë·ªçc s√°ch", description: "B√¨nh y√™n v√† mi·ªÖn ph√≠", cost: 0, category: 'essential' },
                option2: { label: "V√†o net c√πng b·∫°n 20k", description: "Gi·∫£i tr√≠ m·ªôt ch√∫t", cost: 20000, category: 'hobbies' }
            },
            {
                day: 5, question: "S·∫Øp t·ªõi sinh nh·∫≠t m·∫π, b·∫°n ƒë·ªãnh chu·∫©n b·ªã g√¨?",
                option1: { label: "T·ª± tay l√†m thi·ªáp", description: "T·∫•m l√≤ng l√† ch√≠nh", cost: 5000, category: 'essential' },
                option2: { label: "Mua b√≥ hoa nh·ªè 50k", description: "T·∫∑ng m·∫π ni·ªÅm vui b·∫•t ng·ªù", cost: 50000, category: 'hobbies' }
            },
            {
                day: 6, question: "Th·ª© B·∫£y m√°u ch·∫£y v·ªÅ ƒë√¢u? B·∫°n mu·ªën ƒëi ch∆°i kh√¥ng?",
                option1: { label: "ƒêi b·ªô ra c√¥ng vi√™n", description: "H√≠t th·ªü kh√≠ tr·ªùi", cost: 0, category: 'essential' },
                option2: { label: "ƒêi xem phim 80k", description: "Bom t·∫•n m·ªõi ra m·∫Øt", cost: 80000, category: 'hobbies' }
            },
            {
                day: 7, question: "Ch·ªß Nh·∫≠t cu·ªëi tu·∫ßn, b·ªØa t·ªëi c·ªßa b·∫°n l√†...",
                option1: { label: "C∆°m nh√† m·∫π n·∫•u", description: "V·ª´a ngon v·ª´a ·∫•m c√∫ng", cost: 0, category: 'essential' },
                option2: { label: "Order g√† r√°n 65k", description: "Party cu·ªëi tu·∫ßn t·∫°i gia", cost: 65000, category: 'hobbies' }
            }
        ];

        const EVENTS = [
            { description: 'Xe ƒë·∫°p b·ªã h·ªèng x√≠ch gi·ªØa ƒë∆∞·ªùng.', amount: -20000, type: 'bad' },
            { description: 'Nh·∫∑t ƒë∆∞·ª£c 10k r∆°i ·ªü s√¢n tr∆∞·ªùng.', amount: 10000, type: 'good' },
            { description: 'Ph√°t sinh qu·ªπ h·ªôi kh·ªèe ph√π ƒë·ªïng.', amount: -15000, type: 'bad' },
            { description: 'B√† ngo·∫°i sang ch∆°i cho ti·ªÅn ƒÉn qu√†.', amount: 40000, type: 'good' },
            { description: 'L·ª° tay l√†m m·∫•t chi·∫øc t·∫©y m·ªõi mua.', amount: -5000, type: 'bad' },
            { description: 'Anh trai tr·∫£ n·ª£ ti·ªÅn mua h·ªô ƒë·ªì.', amount: 25000, type: 'good' },
            { description: 'Mua h·ªô ƒë·ªì cho c√¥ v√† ƒë∆∞·ª£c gi·ªØ ti·ªÅn th·ª´a.', amount: 15000, type: 'good' },
            { description: 'B·ªã h·ªèng b√∫t m·ª±c, ph·∫£i mua ng√≤i m·ªõi.', amount: -10000, type: 'bad' },
            { description: 'Tr·ªùi m∆∞a ph·∫£i mua √°o m∆∞a nilon.', amount: -10000, type: 'bad' },
            { description: 'ƒê∆∞·ª£c ƒëi·ªÉm 10, b·ªë th∆∞·ªüng n√≥ng!', amount: 30000, type: 'good' },
            { description: 'Qu√™n kh√¥ng mang m≈© b·∫£o hi·ªÉm, b·ªã ph·∫°t nh·∫π.', amount: -20000, type: 'bad' },
            { description: 'T√¨m th·∫•y ti·ªÅn l·∫ª trong t√∫i √°o c≈©.', amount: 5000, type: 'good' },
            { description: 'B·ªã h·ªèng quai d√©p t·ªï ong.', amount: -15000, type: 'bad' },
            { description: 'H√¥m nay l√† m·ªôt ng√†y th·∫≠t b√¨nh y√™n.', amount: 0, type: 'neutral' }
        ];

        // --- COMPONENTS ---
        const JarCard = ({ name, amount, color, icon, initial }) => {
            const fillPercent = Math.max(0, Math.min(100, (amount / (initial || 1)) * 100));
            return (
                <div className="flex-1 bg-white rounded-3xl p-4 shadow-lg border-2 border-slate-50 flex flex-col items-center gap-3 relative overflow-hidden group">
                    <div className={`absolute bottom-0 left-0 right-0 ${color} opacity-10 liquid-fill`} style={{ height: `${fillPercent}%` }} />
                    <div className="text-4xl group-hover:scale-125 transition-transform duration-300 z-10">{icon}</div>
                    <div className="text-center z-10">
                        <div className="text-[10px] font-black uppercase text-slate-400 tracking-tighter">{name}</div>
                        <div className={`text-sm font-black ${amount < 0 ? 'text-red-500' : 'text-slate-800'}`}>
                            {new Intl.NumberFormat('vi-VN').format(amount)}ƒë
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [status, setStatus] = useState('START');
            const [day, setDay] = useState(1);
            const [jars, setJars] = useState({ essential: 80000, hobbies: 70000, savings: 50000 });
            const [initialBudget, setInitialBudget] = useState(null);
            const [history, setHistory] = useState([]);
            const [currentEvents, setCurrentEvents] = useState([]);
            const [currentChoiceLog, setCurrentChoiceLog] = useState(null);
            const [showEventModal, setShowEventModal] = useState(false);

            const totalAllocated = jars.essential + jars.hobbies + jars.savings;
            const isBudgetValid = totalAllocated === INITIAL_TOTAL;

            const formatMoney = (amount) => new Intl.NumberFormat('vi-VN').format(amount) + 'ƒë';

            const startBudgeting = () => setStatus('BUDGETING');

            const confirmBudget = () => {
                if (isBudgetValid) {
                    setInitialBudget({ ...jars });
                    startDayTransition(1);
                }
            };

            const startDayTransition = (nextDay) => {
                setDay(nextDay);
                setStatus('TRANSITION');
                setTimeout(() => setStatus('PLAYING'), 1200);
            };

            const handleChoice = (option) => {
                const tempJars = { ...jars };
                tempJars[option.category] -= option.cost;

                const numEvents = Math.random() > 0.5 ? 2 : 1;
                const selectedEvents = [];
                const pool = [...EVENTS];
                for (let i = 0; i < numEvents; i++) {
                    const idx = Math.floor(Math.random() * pool.length);
                    selectedEvents.push(pool[idx]);
                    pool.splice(idx, 1);
                }

                selectedEvents.forEach(ev => {
                    let amt = ev.amount;
                    if (amt < 0) {
                        let costToCover = Math.abs(amt);
                        if (tempJars.savings >= costToCover) {
                            tempJars.savings -= costToCover;
                        } else {
                            costToCover -= tempJars.savings;
                            tempJars.savings = 0;
                            if (tempJars.essential >= costToCover) {
                                tempJars.essential -= costToCover;
                            } else {
                                costToCover -= tempJars.essential;
                                tempJars.essential = 0;
                                tempJars.hobbies -= costToCover;
                            }
                        }
                    } else {
                        tempJars.savings += amt;
                    }
                });

                const log = {
                    day,
                    choiceLabel: option.label,
                    choiceCost: option.cost,
                    choiceCategory: option.category,
                    eventDescription: selectedEvents.map(e => e.description).join(' & '),
                    eventAmount: selectedEvents.reduce((acc, e) => acc + e.amount, 0),
                    jarsAfter: { ...tempJars }
                };

                setCurrentChoiceLog(option);
                setCurrentEvents(selectedEvents);
                setShowEventModal(true);
                // We update the state once user proceeds
            };

            const handleProceed = () => {
                // Apply the last calculated state from the current interaction
                const combinedEvents = currentEvents;
                const tempJars = { ...jars };
                tempJars[currentChoiceLog.category] -= currentChoiceLog.cost;
                combinedEvents.forEach(ev => {
                    let amt = ev.amount;
                    if (amt < 0) {
                        let costToCover = Math.abs(amt);
                        if (tempJars.savings >= costToCover) { tempJars.savings -= costToCover; } 
                        else { costToCover -= tempJars.savings; tempJars.savings = 0;
                            if (tempJars.essential >= costToCover) { tempJars.essential -= costToCover; } 
                            else { costToCover -= tempJars.essential; tempJars.essential = 0; tempJars.hobbies -= costToCover; }
                        }
                    } else { tempJars.savings += amt; }
                });

                const log = {
                    day,
                    choiceLabel: currentChoiceLog.label,
                    choiceCost: currentChoiceLog.cost,
                    choiceCategory: currentChoiceLog.category,
                    eventDescription: combinedEvents.map(e => e.description).join(' & '),
                    eventAmount: combinedEvents.reduce((acc, e) => acc + e.amount, 0),
                    jarsAfter: { ...tempJars }
                };

                setJars(tempJars);
                setHistory(prev => [log, ...prev]);
                setShowEventModal(false);

                if (day < TOTAL_DAYS) {
                    startDayTransition(day + 1);
                } else {
                    setStatus('SUMMARY');
                }
            };

            const totalBalance = jars.essential + jars.hobbies + jars.savings;

            const getAdvice = useMemo(() => {
                if (totalBalance < 0) return "B·∫°n ƒë√£ chi ti√™u qu√° ƒë√† v√† r∆°i v√†o c·∫£nh n·ª£ n·∫ßn. H√£y h·ªçc c√°ch ti·∫øt ch·∫ø nhu c·∫ßu c√° nh√¢n nh√©!";
                if (jars.savings > (initialBudget?.savings || 0)) return "B·∫°n qu·∫£n l√Ω t√†i ch√≠nh r·∫•t t·ªët! Kh√¥ng ch·ªâ s·ªëng s√≥t m√† c√≤n l√†m gi√†u th√™m h≈© ti·∫øt ki·ªám.";
                if (jars.essential < 0) return "B·∫°n ƒë√£ ƒë·ªÉ th√≥i quen ti√™u x√†i ·∫£nh h∆∞·ªüng ƒë·∫øn c√°c nhu c·∫ßu c∆° b·∫£n. ƒê√¢y l√† m·ªôt c·∫£nh b√°o ƒë·ªè!";
                return "B·∫°n ƒë√£ ho√†n th√†nh th·ª≠ th√°ch! H√£y ch√∫ √Ω h∆°n ƒë·∫øn vi·ªác c√¢n ƒë·ªëi c√°c h≈© ti·ªÅn trong t∆∞∆°ng lai.";
            }, [totalBalance, jars, initialBudget]);

            return (
                <div className="min-h-screen p-4 md:p-8 flex items-center justify-center">
                    <div className="max-w-6xl w-full bg-white/40 backdrop-blur-md rounded-[3rem] p-4 md:p-8 shadow-[0_32px_64px_-12px_rgba(0,0,0,0.1)] border border-white/50 aspect-16-9-container flex flex-col md:flex-row gap-8">
                        
                        {/* Main Game Content Area */}
                        <div className="flex-[2] flex flex-col relative bg-white rounded-[2.5rem] shadow-xl overflow-hidden border-4 border-white">
                            
                            {/* Day Progress Strip */}
                            {(status === 'PLAYING' || status === 'BUDGETING') && (
                                <div className="absolute top-0 left-0 right-0 h-2 flex gap-1 z-20">
                                    {Array.from({ length: TOTAL_DAYS }).map((_, i) => (
                                        <div key={i} className={`flex-1 transition-colors duration-500 ${i + 1 < day ? 'bg-green-400' : i + 1 === day ? 'bg-sky-500 animate-pulse' : 'bg-slate-100'}`} />
                                    ))}
                                </div>
                            )}

                            {/* Transition Screen Overlay */}
                            {status === 'TRANSITION' && (
                                <div className="absolute inset-0 z-50 bg-sky-600 flex flex-col items-center justify-center text-white p-8">
                                    <div className="text-7xl mb-6 floating">üí§</div>
                                    <h2 className="text-5xl font-black mb-2">{DAYS_OF_WEEK[day - 1]}</h2>
                                    <p className="text-sky-100 font-bold opacity-80 italic">Ch√†o bu·ªïi s√°ng, Nam ∆°i!</p>
                                </div>
                            )}

                            {/* Phase: Start */}
                            {status === 'START' && (
                                <div className="flex-1 p-12 flex flex-col items-center justify-center text-center gap-8">
                                    <div className="relative">
                                        <div className="text-9xl floating">üë¶</div>
                                        <div className="absolute -top-4 -right-4 bg-yellow-400 text-white p-4 rounded-full shadow-lg border-4 border-white font-black">200K</div>
                                    </div>
                                    <div className="space-y-4">
                                        <h2 className="text-4xl font-black text-slate-800">Th·ª≠ Th√°ch Qu·∫£n L√Ω T√†i Ch√≠nh</h2>
                                        <p className="text-slate-500 text-lg leading-relaxed max-w-lg mx-auto">
                                            Nam v·ª´a ƒë∆∞·ª£c m·∫π cho 200.000ƒë ƒë·ªÉ chi ti√™u trong 1 tu·∫ßn ƒëi h·ªçc. H√£y gi√∫p Nam ph√¢n b·ªï v√† ti√™u x√†i h·ª£p l√Ω nh√©!
                                        </p>
                                    </div>
                                    <button onClick={startBudgeting} className="w-full max-w-sm py-5 bg-sky-500 hover:bg-sky-600 text-white rounded-3xl font-black text-2xl shadow-2xl transition-all active:scale-95">
                                        B·∫ÆT ƒê·∫¶U CHIA H≈®
                                    </button>
                                </div>
                            )}

                            {/* Phase: Budgeting */}
                            {status === 'BUDGETING' && (
                                <div className="flex-1 p-8 flex flex-col gap-6 overflow-y-auto">
                                    <div className="text-center">
                                        <h2 className="text-3xl font-black">Thi·∫øt L·∫≠p Ng√¢n S√°ch</h2>
                                        <p className="text-slate-400 font-bold uppercase text-xs">T·ªïng ng√¢n s√°ch: {formatMoney(INITIAL_TOTAL)}</p>
                                    </div>
                                    <div className="grid gap-4">
                                        {[
                                            { id: 'essential', label: 'H≈© Thi·∫øt Y·∫øu (ƒÇn, ƒêi l·∫°i)', icon: 'üçö', color: 'accent-emerald-500', bg: 'bg-emerald-50' },
                                            { id: 'hobbies', label: 'H≈© S·ªü Th√≠ch (Gi·∫£i tr√≠, Qu√†)', icon: 'üéÆ', color: 'accent-pink-500', bg: 'bg-pink-50' },
                                            { id: 'savings', label: 'H≈© Ti·∫øt Ki·ªám (Ph√≤ng h·ªù)', icon: 'üí∞', color: 'accent-amber-500', bg: 'bg-amber-50' }
                                        ].map((item) => (
                                            <div key={item.id} className={`${item.bg} p-6 rounded-[2rem] border-2 border-white shadow-sm space-y-4`}>
                                                <div className="flex justify-between items-center">
                                                    <div className="flex items-center gap-3">
                                                        <span className="text-3xl">{item.icon}</span>
                                                        <span className="font-black text-slate-700">{item.label}</span>
                                                    </div>
                                                    <span className="text-xl font-black">{formatMoney(jars[item.id])}</span>
                                                </div>
                                                <input 
                                                    type="range" min="0" max="200000" step="5000"
                                                    value={jars[item.id]}
                                                    onChange={(e) => setJars({...jars, [item.id]: parseInt(e.target.value)})}
                                                    className={`w-full h-3 bg-white rounded-full appearance-none cursor-pointer ${item.color}`}
                                                />
                                            </div>
                                        ))}
                                    </div>
                                    <div className={`p-6 rounded-3xl border-4 flex items-center justify-between mt-auto ${isBudgetValid ? 'bg-green-500 border-green-200 text-white' : 'bg-red-50 border-red-200 text-red-600'}`}>
                                        <div className="text-2xl font-black">T·ªïng: {formatMoney(totalAllocated)}</div>
                                        {isBudgetValid ? (
                                            <button onClick={confirmBudget} className="bg-white text-green-600 px-8 py-3 rounded-2xl font-black text-lg shadow-xl hover:scale-105 active:scale-95 transition-all">
                                                X√ÅC NH·∫¨N ‚úÖ
                                            </button>
                                        ) : (
                                            <span className="font-bold">{totalAllocated > INITIAL_TOTAL ? "Qu√° ti·ªÅn r·ªìi!" : "C√≤n ti·ªÅn ch∆∞a chia!"}</span>
                                        )}
                                    </div>
                                </div>
                            )}

                            {/* Phase: Playing */}
                            {status === 'PLAYING' && !showEventModal && (
                                <div className="flex-1 p-8 md:p-12 flex flex-col gap-8">
                                    <div className="flex items-center gap-6">
                                        <div className="w-24 h-24 bg-sky-100 rounded-[2rem] flex items-center justify-center text-5xl shadow-inner border-4 border-white">üè´</div>
                                        <div className="space-y-1">
                                            <div className="text-sky-500 font-black uppercase text-sm">{DAYS_OF_WEEK[day - 1]}</div>
                                            <h2 className="text-3xl font-black text-slate-800 leading-tight">{SCENARIOS[day - 1].question}</h2>
                                        </div>
                                    </div>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6 flex-1">
                                        {[SCENARIOS[day - 1].option1, SCENARIOS[day - 1].option2].map((opt, i) => (
                                            <button 
                                                key={i}
                                                onClick={() => handleChoice(opt)}
                                                className={`relative p-8 rounded-[2.5rem] border-4 border-slate-50 text-left transition-all hover:scale-[1.03] active:scale-95 group overflow-hidden ${opt.category === 'essential' ? 'bg-emerald-50 hover:border-emerald-400' : 'bg-rose-50 hover:border-rose-400'}`}
                                            >
                                                <div className="absolute top-4 right-4 text-4xl opacity-10 group-hover:opacity-100 transition-all">
                                                    {opt.category === 'essential' ? 'üçö' : 'üéÆ'}
                                                </div>
                                                <div className="flex flex-col h-full justify-between">
                                                    <div className="space-y-2">
                                                        <div className={`text-xs font-black uppercase ${opt.category === 'essential' ? 'text-emerald-500' : 'text-rose-500'}`}>H≈© {opt.category === 'essential' ? 'Thi·∫øt y·∫øu' : 'S·ªü th√≠ch'}</div>
                                                        <div className="text-2xl font-black text-slate-800">{opt.label}</div>
                                                        <p className="text-slate-500 text-sm italic">{opt.description}</p>
                                                    </div>
                                                    <div className="text-2xl font-black text-red-600">-{formatMoney(opt.cost)}</div>
                                                </div>
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* Random Event Modal Overlay */}
                            {showEventModal && (
                                <div className="flex-1 p-8 bg-amber-50 flex flex-col items-center justify-center text-center gap-6 animate-in zoom-in duration-300">
                                    <div className="text-8xl floating">‚ö°</div>
                                    <div className="space-y-4 w-full">
                                        <div className="inline-block bg-amber-400 text-white px-6 py-2 rounded-full font-black uppercase tracking-widest shadow-lg">C√≥ bi·∫øn x·∫£y ra!</div>
                                        <div className="space-y-3 px-8 max-w-md mx-auto">
                                            {currentEvents.map((ev, idx) => (
                                                <div key={idx} className="bg-white/80 p-4 rounded-2xl border-2 border-amber-200 shadow-sm">
                                                    <p className="text-xl font-black text-slate-800 leading-tight mb-1">"{ev.description}"</p>
                                                    <p className={`text-lg font-black ${ev.amount > 0 ? 'text-green-500' : ev.amount < 0 ? 'text-red-500' : 'text-slate-400'}`}>
                                                        {ev.amount === 0 ? 'M·ªçi th·ª© v·∫´n ·ªïn' : (ev.amount > 0 ? '+' : '-') + formatMoney(Math.abs(ev.amount))}
                                                    </p>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                    <button onClick={handleProceed} className="w-full max-w-sm py-5 bg-slate-900 hover:bg-slate-800 text-white rounded-3xl font-black text-xl shadow-2xl active:scale-95 transition-all">
                                        XEM K·∫æT QU·∫¢ NG√ÄY M·ªöI
                                    </button>
                                </div>
                            )}

                            {/* Phase: Summary */}
                            {status === 'SUMMARY' && (
                                <div className="flex-1 p-8 flex flex-col items-center justify-center text-center gap-6 overflow-y-auto">
                                    <div className="text-9xl">{totalBalance > 0 ? 'üèÜ' : 'üí∏'}</div>
                                    <div className="space-y-1">
                                        <h2 className="text-4xl font-black">T·ªïng K·∫øt Tu·∫ßn H·ªçc</h2>
                                        <div className="text-5xl font-black text-sky-600 tabular-nums">{formatMoney(totalBalance)}</div>
                                    </div>
                                    
                                    <div className="bg-slate-50 p-6 rounded-[2.5rem] max-w-2xl w-full border-4 border-white shadow-inner grid grid-cols-1 md:grid-cols-3 gap-4">
                                        {[
                                            { label: 'Thi·∫øt y·∫øu', icon: 'üçö', amt: jars.essential, init: initialBudget?.essential, type: 'essential' },
                                            { label: 'S·ªü th√≠ch', icon: 'üéÆ', amt: jars.hobbies, init: initialBudget?.hobbies, type: 'hobbies' },
                                            { label: 'Ti·∫øt ki·ªám', icon: 'üí∞', amt: jars.savings, init: initialBudget?.savings, type: 'savings' }
                                        ].map((item, idx) => (
                                            <div key={idx} className="bg-white p-4 rounded-2xl shadow-sm border-2 border-slate-100 flex flex-col items-center">
                                                <div className="text-3xl mb-1">{item.icon}</div>
                                                <div className="text-[10px] font-black text-slate-400 uppercase leading-none mb-1">H≈© {item.label}</div>
                                                <div className={`text-xs font-black mb-1 ${item.amt < 0 ? 'text-red-500' : 'text-green-600'}`}>
                                                    {item.amt < 0 ? 'B·ªã th√¢m h·ª•t!' : item.amt >= item.init ? 'Tuy·ªát v·ªùi!' : 'H·ª£p l√Ω'}
                                                </div>
                                                <div className="text-[10px] text-slate-400">C√≤n: {formatMoney(item.amt)}</div>
                                            </div>
                                        ))}
                                    </div>

                                    <p className="text-lg text-slate-600 italic px-8 max-w-lg">"{getAdvice}"</p>
                                    <button onClick={() => window.location.reload()} className="w-full max-w-sm py-5 bg-sky-500 hover:bg-sky-600 text-white rounded-3xl font-black text-xl shadow-2xl transition-all">
                                        CH∆†I L·∫†I TU·∫¶N SAU
                                    </button>
                                </div>
                            )}
                        </div>

                        {/* Right Side: Status Sidebar (Desktop Only) */}
                        {(status === 'PLAYING' || status === 'SUMMARY' || status === 'TRANSITION') && (
                            <div className="hidden lg:flex flex-col w-80 gap-6">
                                <div className="bg-white/60 p-6 rounded-[2.5rem] shadow-lg border border-white flex flex-col gap-4">
                                    <h3 className="text-xs font-black text-slate-400 uppercase tracking-widest ml-2">S·ªë d∆∞ h≈© ti·ªÅn</h3>
                                    <JarCard name="Thi·∫øt y·∫øu" amount={jars.essential} initial={initialBudget?.essential} color="bg-emerald-400" icon="üçö" />
                                    <JarCard name="S·ªü th√≠ch" amount={jars.hobbies} initial={initialBudget?.hobbies} color="bg-rose-400" icon="üéÆ" />
                                    <JarCard name="Ti·∫øt ki·ªám" amount={jars.savings} initial={initialBudget?.savings} color="bg-amber-400" icon="üí∞" />
                                </div>

                                <div className="bg-white/60 p-6 rounded-[2.5rem] shadow-lg border border-white flex-1 flex flex-col overflow-hidden">
                                    <h3 className="text-xs font-black text-slate-400 uppercase tracking-widest ml-2 mb-4">Nh·∫≠t k√Ω s·ª± ki·ªán</h3>
                                    <div className="flex-1 overflow-y-auto pr-2 space-y-3 scrollbar-none">
                                        {history.map((h, i) => (
                                            <div key={i} className="bg-white/80 p-3 rounded-2xl shadow-sm border border-slate-100 text-[10px] flex flex-col gap-1">
                                                <div className="flex justify-between font-black text-slate-400 uppercase tracking-tighter">
                                                    <span>Ng√†y {h.day}</span>
                                                    <span className="text-slate-700">{h.choiceLabel}</span>
                                                </div>
                                                <div className="text-slate-600 italic">{h.eventDescription}</div>
                                            </div>
                                        ))}
                                        {history.length === 0 && <div className="text-slate-300 text-center py-8 italic text-xs">Nam ch∆∞a c√≥ s·ª± ki·ªán g√¨.</div>}
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Background elements */}
                    <div className="fixed top-10 left-10 text-8xl opacity-10 floating pointer-events-none select-none">‚úèÔ∏è</div>
                    <div className="fixed bottom-10 right-10 text-8xl opacity-10 floating pointer-events-none select-none" style={{ animationDelay: '1s' }}>üìì</div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
